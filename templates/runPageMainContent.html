{# Display histograms here #}
<h1 id="mainContentTitle">{{ run.prettyName }}</h1>
<p>
    {{ run.prettyName }} started at {{ subsystem.prettyPrintUnixTime(subsystem.startOfRun) }} (CERN time zone).</br>
   <a target="_blank" href="https://alice-logbook.cern.ch/logbook/date_online.php?p_cont=rund&p_run={{ run.runNumber }}">Logbook entry</a>
</p>
<hr />

{% if useGrid %}
    {# How to handle a grid #}
{% else %}
    {# NOTE: We cannot use loop.first because we loop through many empty histGroups! #}
    {# See: https://stackoverflow.com/a/4880398 #}
    {% set firstLoopCompleted = [] %}
    {% for histGroupName, histGroup in subsystem.histGroups.iteritems() %}
        {% if selectedHistGroup == histGroupName or (selectedHistGroup == None and firstLoopCompleted == []) %}
            {%- for histName in histGroup.histList -%}
                {% if firstLoopCompleted.append(1) %}{% endif %}
                {%- set hist = subsystem.hists[histName] %}
                {% if selectedHist == hist.histName or selectedHist == None %}
                    <a class="anchor" data-histname="{{ hist.histName }}" data-histgroup="{{ histGroup.selectionPattern }}" name="{{ hist.histName }}"></a>
                    <h2>{{ hist.prettyName }}</h2>
                    {# TODO: Improve this line! #}
                    {%- set filenameImage = subsystem.imgDir.replace("data/", "") + "/" + hist.histName + ".png" -%}
                    {%- set filenameJSON = subsystem.jsonDir.replace("data/", "") + "/" + hist.histName + ".json" -%}
                    <div class="histogramContainer" data-filename="{{ filenameJSON }}">
                    {% if jsRoot != True %}
                        <img src="{{ url_for("protected", filename=filenameImage) }}" alt="{{ hist.histName }}">
                    {% endif %}
                    </div>
                {% endif %}
            {% endfor -%}
        {% endif %}
    {% endfor %}
{% endif %}
